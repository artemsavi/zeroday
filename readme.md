 # zero-day

## Описание

**zero-day** — это учебный проект на FastAPI с базовой аутентификацией пользователей через JWT (JSON Web Token) и возможностью просмотра информации о пользователе. Проект демонстрирует работу с паролями (bcrypt), хранение пользователей в памяти, а также защиту эндпоинтов с помощью токенов.

## Функционал

- Аутентификация пользователей по логину и паролю.
- Генерация JWT-токена при успешном входе.
- Защищённый эндпоинт для просмотра информации о пользователе (имя, зарплата, дата следующего повышения).
- Пароли пользователей хранятся в виде хэшей (bcrypt).
- Используется асимметричное шифрование (RS256) для подписи токенов.

## Структура проекта

```
fastapi-app/
  main.py                # Точка входа FastAPI-приложения
  api/
    auth.py              # Логика аутентификации и работы с токенами
    config.py            # Конфигурация приложения (ключи, алгоритмы)
    users_log_pass_db.py # "База данных" пользователей (в памяти)
    models.py            # Pydantic-модели для валидации данных
  certs/                 # Сюда нужно поместить ключи для JWT (см. ниже)
```

## Требования

- Python >= 3.13
- FastAPI
- Uvicorn
- Pydantic
- pydantic-settings
- PyJWT (с поддержкой crypto)
- bcrypt
- python-multipart

Все зависимости указаны в `pyproject.toml`.

## Быстрый старт

1. **Клонируйте репозиторий и установите зависимости:**
   ```bash
   cd fastapi-app
   pip install poetry
   poetry install
   ```

2. **Создайте ключи для JWT:**
   В папке `fastapi-app/certs/` должны быть два файла:
   - `rs256_private.pem` — приватный ключ (для подписи токенов)
   - `rs256_public.pem` — публичный ключ (для проверки токенов)

   Пример генерации ключей:
   ```bash
   mkdir -p certs
   openssl genrsa -out certs/rs256_private.pem 2048
   openssl rsa -in certs/rs256_private.pem -pubout -out certs/rs256_public.pem
   ```

3. **Запустите приложение:**
   ```bash
   poetry run python main.py
   ```
   Приложение будет доступно по адресу: http://127.0.0.1:8000

## Примеры запросов

### 1. Получение токена

`POST /login`

**Параметры формы:**
- `username`
- `password`

**Пример запроса:**
```bash
curl -X POST -F "username=dmitri" -F "password=qwerty" http://127.0.0.1:8000/login
```

**Ответ:**
```json
{"token": "<ваш JWT токен>"}
```

### 2. Получение информации о пользователе

`GET /check`

**Требуется заголовок:**
```
Authorization: Bearer <ваш JWT токен>
```

**Пример запроса:**
```bash
curl -H "Authorization: Bearer <ваш JWT токен>" http://127.0.0.1:8000/check
```

**Ответ:**
```json
{
  "name": "dmitri",
  "salary": "110.000",
  "next_raise_at": "01.01.2026"
}
```

## Пользователи по умолчанию

В системе уже есть несколько пользователей (см. `users_log_pass_db.py`):

| username | password  |
|----------|-----------|
| dmitri   | qwerty    |
| max      | password  |
| olga     | 1234567   |

## Лицензия

MIT 